1. Validar base de datos
sqoop list-databases --connect jdbc:mysql://34.205.65.241:3306 --username bootcamp --password bootcamp
2. Descargar archivo log
wget http://34.205.65.241/access.log
3. cargar a archivo carpeta hdfs
hdfs dfs -mkdir /user/sarango/desafio
4. cargar archivo hdfs
hdfs dfs -put /home/ec2-user/desafio/* /user/sarango/desafio
5. Revisar los archivos agregados al HDFS
hdfs dfs -ls /user/sarango/desafio
6. Crear tabla LOG en HIVE, archivo .log que fue cargado a fichero HDFS
CREATE EXTERNAL TABLE log (
        `ip`                STRING,
        `time_local`        STRING,
        `method`            STRING,
        `uri`               STRING,
        `protocol`          STRING,
        `status`            STRING,
        `bytes_sent`        STRING,
        `referer`           STRING,
        `useragent`         STRING
        )
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.RegexSerDe'
WITH SERDEPROPERTIES ("input.regex" = '^(\\S+) \\S+ \\S+ \\[([^\\[]+)\\] "(\\w+) (\\S+) (\\S+)" (\\d+) (\\d+) "([^"]+)" "([^"]+)".*') 
LOCATION '/user/sarango/desafio/';

7. Consultar y validar datos 
SELECT * FROM sarango.log LIMIT 100;

8. Importar tabla 
sqoop import --driver com.mysql.jdbc.Driver --connect jdbc:mysql://34.205.65.241:3306/ecommerce_cloudera --username bootcamp --password bootcamp --table product_transaction --split-by transaction_id --target-dir /user/sarango/desafio/prd

9. Crear tabla en HIVE de product_transaction, tabla que fue cargada a fichero en HDFS

CREATE EXTERNAL TABLE product_transaction (
  transaction_id INT,
  transaction_time TIMESTAMP,
  customer_ssn  STRING,
  customer_name STRING,
  customer_email STRING,
  customer_adress STRING,
  customer_state STRING,
  customer_zipcode STRING,
  product_id INT,
  product_cantity INT
 ) ROW FORMAT delimited fields TERMINATED BY ','
 STORED AS TEXTFILE LOCATION '/user/sarango/desafio/prd';
 
10. Consultar y validar datos 
SELECT * FROM sarango.product_transaction LIMIT 100;

11. cambiar permiso a carpeta desafio
hdfs dfs -chmod 777  /user/sarango/desafio/

11.1 Validar permisos 
hdfs dfs -ls /user/sarango/desafio
hdfs dfs -ls /user/sarango/desafio/prd

12. Crear tabla temporal para cargar la conversi√≥n de la venta
CREATE TABLE conversion_5_1 AS 
SELECT tbl1.skuID as sku, (tbl2.ventas / tbl1.visita) as conversion 
FROM 
    (select substring(uri,length(uri)-5) as skuID, count(0) as visita 
    from log
    group by substring(uri,length(uri)-5)) tbl1
JOIN
    (select product_id as skuID, sum(product_cantity) as ventas 
    from product_transaction
    group by product_id) tbl2
ON tbl1.skuID = tbl2.skuID;





